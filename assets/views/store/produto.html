{%% extends "store/layouts/base.html" %%}
{%% block title %%}Produto{%% endblock %%}

{%% block content %%}
<div class="max-w-7xl mx-auto px-4 py-10">
  <div x-data="ProductDetail('{{ product_pid }}')" x-init="init()">

    <!-- Loading -->
    <div x-show="loading" class="grid grid-cols-1 md:grid-cols-2 gap-12 animate-pulse">
      <div class="aspect-square bg-gray-100 rounded-2xl"></div>
      <div class="space-y-4 pt-4">
        <div class="h-8 bg-gray-100 rounded w-3/4"></div>
        <div class="h-6 bg-gray-100 rounded w-1/4"></div>
        <div class="h-12 bg-gray-100 rounded w-full"></div>
      </div>
    </div>

    <!-- Produto -->
    <div x-show="!loading" class="grid grid-cols-1 md:grid-cols-2 gap-12">
      <!-- Galeria -->
      <div>
        <div class="aspect-square bg-gray-100 rounded-2xl overflow-hidden mb-4">
          <img :src="mainImage" :alt="product?.title" class="w-full h-full object-cover">
        </div>
        <div class="flex gap-3 overflow-x-auto pb-2">
          <template x-for="(img, i) in images" :key="i">
            <img :src="img" @click="mainImage = img"
                 :class="mainImage === img ? 'ring-2 ring-gray-900' : 'ring-1 ring-gray-200 opacity-70'"
                 class="w-20 h-20 object-cover rounded-xl cursor-pointer flex-shrink-0 hover:opacity-100 transition-opacity">
          </template>
        </div>
      </div>

      <!-- Detalhes -->
      <div class="space-y-6">
        <div>
          <p class="text-sm text-gray-500 mb-1" x-text="product?.category_name"></p>
          <h1 class="text-3xl font-bold text-gray-900" x-text="product?.title"></h1>
        </div>

        <p class="text-3xl font-bold text-gray-900" x-text="selectedPrice"></p>

        <!-- Opções -->
        <template x-for="opt in options" :key="opt.name">
          <div>
            <p class="text-sm font-semibold text-gray-700 mb-2" x-text="opt.name"></p>
            <div class="flex flex-wrap gap-2">
              <template x-for="val in opt.values" :key="val">
                <button @click="selectOption(opt.name, val)"
                        :class="selectedOptions[opt.name] === val
                          ? 'bg-gray-900 text-white border-gray-900'
                          : 'bg-white text-gray-700 border-gray-300 hover:border-gray-500'"
                        class="px-4 py-2 border rounded-xl text-sm font-medium transition-colors"
                        x-text="val">
                </button>
              </template>
            </div>
          </div>
        </template>

        <!-- Quantidade -->
        <div>
          <p class="text-sm font-semibold text-gray-700 mb-2">Quantidade</p>
          <div class="flex items-center gap-3 border border-gray-300 rounded-xl w-fit px-4 py-2.5">
            <button @click="qty > 1 && qty--" class="text-xl font-bold w-6 text-center leading-none">−</button>
            <span x-text="qty" class="text-lg font-semibold w-8 text-center"></span>
            <button @click="qty++" class="text-xl font-bold w-6 text-center leading-none">+</button>
          </div>
        </div>

        <!-- Botões -->
        <div class="flex gap-3">
          <button @click="addToCart()"
                  :disabled="!inStock || $store.cart.loading"
                  class="flex-1 py-4 bg-gray-900 text-white rounded-xl font-bold text-lg disabled:opacity-50 hover:bg-gray-700 transition-colors">
            <span x-show="$store.cart.loading"><i class="fas fa-spinner fa-spin mr-2"></i></span>
            <span x-show="inStock">Adicionar ao carrinho</span>
            <span x-show="!inStock">Sem estoque</span>
          </button>
          <button @click="toggleWishlist()"
                  :class="inWishlist ? 'text-red-500 border-red-300 bg-red-50' : 'text-gray-500 border-gray-300 hover:bg-gray-50'"
                  class="px-4 py-4 border rounded-xl transition-colors text-xl">
            <i x-show="inWishlist" class="fas fa-heart"></i>
            <i x-show="!inWishlist" class="far fa-heart"></i>
          </button>
        </div>

        <!-- Descrição -->
        <div class="border-t border-gray-200 pt-6">
          <p class="text-sm font-semibold text-gray-700 mb-2">Descrição</p>
          <div class="prose prose-sm text-gray-600 max-w-none" x-html="product?.description || ''"></div>
        </div>
      </div>
    </div>
  </div>
</div>
{%% endblock %%}
